- name: Download "{{module}}"
  get_url: 
    url: "https://github.com/{{module_path}}/archive/master.zip"
    dest: /tmp/master.zip

- name: Unzip the Download
  unarchive:
     src: /tmp/master.zip
     dest: "{{ lookup('env','MT_DISK') }}/mods"
     owner: minetest
     group: minetest
     remote_src: true

- name: Add Config Line for "{{module}} in world.mt"
  lineinfile:
    path: "{{ lookup('env','MT_DISK') }}/data/world.mt"
    regexp: "^load_mod_{{item}} ="
    line: "load_mod_{{item}} = true"
  loop: "{{load_mods }}"
  notify: "Restart Minetest Service"

- name: Add Config Line for "{{module}} in minetest.conf"
  lineinfile:
    path: "{{ lookup('env','MT_DISK') }}/conf/minetest.conf"
    regexp: "^{{item}}"
    line: "{{item}}"
  loop: "{{load_conf | default([])}}"
  notify: "Restart Minetest Service"
